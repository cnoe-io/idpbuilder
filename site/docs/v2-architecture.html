<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IDP Builder V2 Controller-Based Architecture">
    <title>V2 Controller Architecture | IDP Builder</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        .docs-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        .docs-sidebar {
            position: sticky;
            top: 80px;
            height: fit-content;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }
        .docs-sidebar ul {
            list-style: none;
            padding: 0;
        }
        .docs-sidebar li {
            margin-bottom: 0.5rem;
        }
        .docs-sidebar a {
            text-decoration: none;
            color: var(--text-color);
            padding: 0.5rem;
            display: block;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .docs-sidebar a:hover,
        .docs-sidebar a.active {
            background-color: var(--bg-alt);
            color: var(--primary-color);
        }
        .docs-sidebar details {
            margin-bottom: 0.5rem;
        }
        .docs-sidebar summary {
            cursor: pointer;
            padding: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--text-muted);
            user-select: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .docs-sidebar summary:hover {
            background-color: var(--bg-alt);
        }
        .docs-sidebar details[open] > summary {
            background-color: var(--bg-alt);
            margin-bottom: 0.5rem;
        }
        .docs-sidebar details ul {
            margin-left: 0;
            padding-left: 1rem;
        }
        .docs-sidebar h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
        }
        .docs-sidebar h3:first-child {
            margin-top: 0;
        }
        .docs-content {
            max-width: 900px;
            width: 100%;
        }
        .docs-content h1 {
            margin-bottom: 1rem;
        }
        .docs-content h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        .docs-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .docs-content p {
            margin-bottom: 1rem;
        }
        .docs-content ul, .docs-content ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }
        .docs-content li {
            margin-bottom: 0.5rem;
        }
        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        .info-box p {
            margin: 0;
        }
        .mermaid {
            margin: 1.5rem 0;
            text-align: center;
        }
        /* Prism code block styling */
        pre[class*="language-"] {
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        code[class*="language-"] {
            font-size: 0.9rem;
        }
        @media (max-width: 768px) {
            .docs-container {
                grid-template-columns: 1fr;
            }
            .docs-sidebar {
                position: relative;
                top: 0;
                background-color: var(--bg-alt);
                padding: 1rem;
                border-radius: 5px;
                margin-bottom: 1rem;
            }
            .docs-sidebar h3 {
                margin-top: 0;
            }
            .docs-content {
                max-width: 100%;
                overflow-x: hidden;
            }
            .mermaid {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">
                <h1>IDP Builder</h1>
            </div>
            <button class="menu-toggle" aria-label="Toggle menu" onclick="toggleMenu()">
                ☰
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="/">Home</a></li>
                <li><a href="/docs">Docs</a></li>
                <li><a href="/docs/examples.html">Examples</a></li>
                <li><a href="https://github.com/cnoe-io/idpbuilder" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="docs-container">
            <aside class="docs-sidebar">
                <h3>Documentation</h3>
                <ul>
                    <li><a href="/docs">Overview</a></li>
                    <li><a href="/docs/v2-architecture.html" class="active">V2 Architecture</a></li>
                </ul>
                
                <details>
                    <summary>Examples</summary>
                    <ul>
                        <li><a href="/docs/examples.html">Examples Overview</a></li>
                        <li><a href="/docs/examples/platform-simple.html">Simple Platform</a></li>
                        <li><a href="/docs/examples/platform-complete.html">Complete Platform</a></li>
                        <li><a href="/docs/examples/giteaprovider-simple.html">Simple GiteaProvider</a></li>
                    </ul>
                </details>
                
                <details>
                    <summary>V1Alpha2 Examples</summary>
                    <ul>
                        <li><a href="/docs/examples/v1alpha2/platform-with-gateway.html">Platform with Gateway</a></li>
                        <li><a href="/docs/examples/v1alpha2/giteaprovider.html">GiteaProvider</a></li>
                        <li><a href="/docs/examples/v1alpha2/nginxgateway.html">NginxGateway</a></li>
                    </ul>
                </details>
                
                <details>
                    <summary>Technical Specs</summary>
                    <ul>
                        <li><a href="/docs/specs/controller-architecture-spec.html">V2 Controller Architecture</a></li>
                        <li><a href="/docs/specs/hyperscaler-provider-spec.html">Hyperscaler Provider</a></li>
                        <li><a href="/docs/specs/pluggable-packages.html">Pluggable Packages</a></li>
                    </ul>
                </details>
                
                <details>
                    <summary>User Guides</summary>
                    <ul>
                        <li><a href="/docs/user/minimum-requirements.html">Minimum Requirements</a></li>
                        <li><a href="/docs/user/private-registries.html">Private Registries</a></li>
                    </ul>
                </details>
                
                <h3>External Links</h3>
                <ul>
                    <li><a href="https://cnoe.io/docs/idpbuilder" target="_blank" rel="noopener">Full Docs ↗</a></li>
                </ul>
            </aside>

            <article class="docs-content">
                <h1>V2 Controller-Based Architecture</h1>
                
                <div class="info-box">
                    <p><strong>Status:</strong> Proposal - This document describes the proposed V2 architecture for idpbuilder, transitioning from a CLI-driven installation model to a controller-based architecture.</p>
                </div>

                <h2 id="executive-summary">Executive Summary</h2>
                <p>The V2 architecture represents a significant evolution of idpbuilder, transitioning from a CLI-driven installation model to a controller-based architecture. This change enables idpbuilder to function as a true Kubernetes-native platform, where infrastructure components and application workloads are managed declaratively through Kubernetes Custom Resources (CRs) and reconciliation loops.</p>

                <h2 id="goals">Goals</h2>
                <ul>
                    <li><strong>Kubernetes-Native Management:</strong> Enable all functionality to be managed through kubectl and GitOps tools like ArgoCD</li>
                    <li><strong>Separation of Concerns:</strong> Clearly delineate infrastructure provisioning from application/service management</li>
                    <li><strong>Production Readiness:</strong> Support production workloads and virtualized control planes (e.g., vCluster, Cluster API)</li>
                    <li><strong>Extensibility:</strong> Allow easier integration of additional services and customization by end users</li>
                    <li><strong>Operational Excellence:</strong> Improve observability, debugging, and lifecycle management through standard Kubernetes patterns</li>
                </ul>

                <h2 id="benefits">Key Benefits</h2>
                <ul>
                    <li><strong>Kubernetes-Native:</strong> Everything manageable via kubectl, full GitOps compatibility, standard Kubernetes patterns</li>
                    <li><strong>Operational Excellence:</strong> Better observability through conditions, events, and metrics; easier debugging with kubectl describe and logs</li>
                    <li><strong>Flexibility:</strong> Easy component customization, support for alternative components, plugin architecture</li>
                    <li><strong>Production-Ready:</strong> HA configurations supported, proper separation of concerns, infrastructure-agnostic</li>
                    <li><strong>Extensibility:</strong> Third-party controllers can integrate, package ecosystem enablement, easier community contributions</li>
                </ul>

                <h2 id="high-level-design">High-Level Design</h2>
                <p>The new architecture introduces a composable, provider-based system where platform components are defined as separate Custom Resources with duck-typed interfaces. This enables:</p>
                <ul>
                    <li>Multiple provider implementations running simultaneously</li>
                    <li>Pluggable Git providers (Gitea, GitHub, GitLab)</li>
                    <li>Pluggable Gateway providers (Nginx Ingress, Envoy Gateway, Istio Gateway)</li>
                    <li>GitOps management (ArgoCD, Flux)</li>
                </ul>

                <div class="mermaid">
graph TB
    subgraph Infrastructure["Infrastructure Layer"]
        CLI["CLI/Operator<br/>- Provisions Kubernetes cluster<br/>- Installs idpbuilder-controllers<br/>- Creates initial Platform CR"]
    end
    
    subgraph Platform["Platform Controllers (On-Cluster)"]
        PR["PlatformReconciler<br/>- Orchestrates platform bootstrap<br/>- References provider CRs<br/>- Aggregates component status"]
        
        subgraph GitProviders["Git Provider Controllers"]
            GP1["GiteaProviderReconciler"]
            GP2["GitHubProviderReconciler"]
            GP3["GitLabProviderReconciler"]
        end
        
        subgraph GatewayProviders["Gateway Provider Controllers"]
            GW1["NginxGatewayReconciler"]
            GW2["EnvoyGatewayReconciler"]
            GW3["IstioGatewayReconciler"]
        end
        
        subgraph GitOpsProviders["GitOps Provider Controllers"]
            GO1["ArgoCDProviderReconciler"]
            GO2["FluxProviderReconciler"]
        end
    end
    
    CLI --> PR
    PR -.-> GitProviders
    PR -.-> GatewayProviders
    PR -.-> GitOpsProviders
    
    style Infrastructure fill:#e3f2fd
    style Platform fill:#f5f5f5
    style GitProviders fill:#fff9c4
    style GatewayProviders fill:#e1f5fe
    style GitOpsProviders fill:#f3e5f5
</div>

                <h3>Key Architecture Principles</h3>
                <ol>
                    <li><strong>Duck Typing:</strong> Providers expose common status fields without requiring a shared interface type</li>
                    <li><strong>Composition:</strong> Platform references multiple provider CRs by name and kind</li>
                    <li><strong>Extensibility:</strong> New provider types can be added without modifying Platform CR</li>
                    <li><strong>Independence:</strong> Each provider CR can exist and be managed independently</li>
                    <li><strong>Flexibility:</strong> Components choose providers dynamically at runtime</li>
                </ol>

                <h2 id="duck-typing">Duck Typing: Provider Independence Through Standard Status Fields</h2>
                
                <div class="info-box">
                    <p><strong>What is Duck Typing?</strong> Duck typing is a design pattern where different implementations (providers) expose common status fields without requiring a shared interface type. The name comes from the phrase "If it walks like a duck and quacks like a duck, it's a duck." In our case, if a provider has the expected status fields, it can be used interchangeably with other providers of the same type.</p>
                </div>

                <p>The V2 architecture uses duck typing to enable different provider implementations to work together seamlessly. This allows the Platform controller and other components to interact with any Git, Gateway, or GitOps provider through standard status fields, without knowing the specific implementation details.</p>

                <h3>How Duck Typing Works</h3>
                <p>Each provider type (Git, Gateway, GitOps) exposes a set of common status fields. Other controllers access these fields using unstructured access, allowing them to work with any provider implementation that exposes the required fields.</p>

                <div class="mermaid">
graph TB
    subgraph Platform["Platform Controller"]
        PC["PlatformReconciler<br/>Uses duck-typed interface"]
    end
    
    subgraph Consumers["Consumer Controllers"]
        GRC["GitRepositoryReconciler<br/>Needs Git provider info"]
        PKG["PackageReconciler<br/>Needs GitOps provider info"]
        ING["IngressReconciler<br/>Needs Gateway provider info"]
    end
    
    subgraph GitProviders["Git Providers (Duck-Typed)<br/>Common status fields:<br/>• endpoint<br/>• internalEndpoint<br/>• credentialsSecretRef"]
        style GitProviders fill:#fff9c4
        direction LR
        GP1["GiteaProvider"]
        GP2["GitHubProvider"]
        GP3["GitLabProvider"]
    end
    
    subgraph GatewayProviders["Gateway Providers (Duck-Typed)<br/>Common status fields:<br/>• ingressClassName<br/>• loadBalancerEndpoint<br/>• internalEndpoint"]
        style GatewayProviders fill:#e1f5fe
        direction LR
        GW1["NginxGateway"]
        GW2["EnvoyGateway"]
        GW3["IstioGateway"]
    end
    
    subgraph GitOpsProviders["GitOps Providers (Duck-Typed)<br/>Common status fields:<br/>• endpoint<br/>• internalEndpoint<br/>• credentialsSecretRef"]
        style GitOpsProviders fill:#f3e5f5
        direction LR
        GO1["ArgoCDProvider"]
        GO2["FluxProvider"]
    end
    
    PC -.->|reads status via<br/>unstructured access| GitProviders
    PC -.->|reads status via<br/>unstructured access| GatewayProviders
    PC -.->|reads status via<br/>unstructured access| GitOpsProviders
    
    GRC -.->|uses any Git provider| GitProviders
    ING -.->|uses any Gateway provider| GatewayProviders
    PKG -.->|uses any GitOps provider| GitOpsProviders
    
    classDef provider fill:#f9f9f9,stroke:#333,stroke-width:2px
    class GP1,GP2,GP3,GW1,GW2,GW3,GO1,GO2 provider
                </div>

                <h3>Standard Status Fields by Provider Type</h3>

                <h4>Git Provider Status Fields</h4>
                <p>All Git providers (Gitea, GitHub, GitLab) must expose these status fields:</p>
                <pre class="line-numbers language-yaml"><code class="language-yaml">status:
  # Standard Kubernetes conditions
  conditions:
    - type: Ready
      status: "True"
      lastTransitionTime: "2025-12-19T10:00:00Z"
      reason: ProviderReady
      message: "Git provider is operational"
  
  # Duck-typed fields for Git operations
  endpoint: string              # External URL for web UI and git clone
  internalEndpoint: string      # Cluster-internal URL for API access
  credentialsSecretRef:         # Secret containing access credentials
    name: string                # Secret name
    namespace: string           # Secret namespace
    key: string                 # Key within secret (e.g., "token", "password")</code></pre>

                <h4>Gateway Provider Status Fields</h4>
                <p>All Gateway providers (Nginx, Envoy, Istio) must expose these status fields:</p>
                <pre class="line-numbers language-yaml"><code class="language-yaml">status:
  # Standard Kubernetes conditions
  conditions:
    - type: Ready
      status: "True"
      lastTransitionTime: "2025-12-19T10:00:00Z"
      reason: GatewayReady
      message: "Gateway is operational"
  
  # Duck-typed fields for routing operations
  ingressClassName: string      # Ingress class name to use in Ingress resources
  loadBalancerEndpoint: string  # External endpoint for accessing services
  internalEndpoint: string      # Cluster-internal API endpoint</code></pre>

                <h4>GitOps Provider Status Fields</h4>
                <p>All GitOps providers (ArgoCD, Flux) must expose these status fields:</p>
                <pre class="line-numbers language-yaml"><code class="language-yaml">status:
  # Standard Kubernetes conditions
  conditions:
    - type: Ready
      status: "True"
      lastTransitionTime: "2025-12-19T10:00:00Z"
      reason: GitOpsReady
      message: "GitOps provider is operational"
  
  # Duck-typed fields for GitOps operations
  endpoint: string              # External URL for web UI
  internalEndpoint: string      # Cluster-internal API endpoint
  credentialsSecretRef:         # Admin credentials
    name: string                # Secret name
    namespace: string           # Secret namespace
    key: string                 # Key within secret (e.g., "password", "token")</code></pre>

                <h3>Benefits of Duck Typing</h3>
                <ul>
                    <li><strong>Provider Independence:</strong> Controllers can work with any provider implementation without tight coupling</li>
                    <li><strong>Extensibility:</strong> New provider types can be added without modifying existing controllers</li>
                    <li><strong>Flexibility:</strong> Multiple providers of the same type can coexist and be swapped easily</li>
                    <li><strong>Simplified Integration:</strong> Consumer controllers only need to know about standard status fields</li>
                    <li><strong>No Shared Interfaces:</strong> Providers don't need to implement a common interface in Go code</li>
                    <li><strong>Runtime Polymorphism:</strong> The Platform can reference different provider kinds dynamically</li>
                </ul>

                <h3>Example: GitRepository Using Any Git Provider</h3>
                <p>The GitRepository controller can create repositories in any Git provider by accessing the duck-typed status fields:</p>
                <pre class="line-numbers language-go"><code class="language-go">// GitRepositoryReconciler works with any Git provider via duck-typing
func (r *GitRepositoryReconciler) Reconcile(ctx context.Context, req ctrl.Request) {
    // Fetch the provider CR (could be GiteaProvider, GitHubProvider, etc.)
    provider := &unstructured.Unstructured{}
    provider.SetGroupVersionKind(gitRepo.Spec.GitServerRef.GroupVersionKind())
    err := r.Get(ctx, types.NamespacedName{
        Name: gitRepo.Spec.GitServerRef.Name,
        Namespace: gitRepo.Spec.GitServerRef.Namespace,
    }, provider)
    
    // Extract duck-typed status fields using unstructured access
    status := provider.Object["status"].(map[string]interface{})
    endpoint := status["endpoint"].(string)
    internalEndpoint := status["internalEndpoint"].(string)
    credsRef := status["credentialsSecretRef"].(map[string]interface{})
    
    // Use the provider regardless of its specific implementation
    client := git.NewClient(endpoint, internalEndpoint, credsRef)
    client.CreateRepository(gitRepo.Spec.Name, gitRepo.Spec.Organization)
}</code></pre>

                <h2 id="custom-resources">Custom Resource Definitions</h2>
                
                <h3>Platform CR</h3>
                <p>The Platform CR represents the entire IDP platform instance:</p>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: Platform
metadata:
  name: localdev
  namespace: idpbuilder-system
spec:
  domain: cnoe.localtest.me
  
  components:
    gitProviders:
      - name: gitea-local
        kind: GiteaProvider
        namespace: idpbuilder-system
    
    gateways:
      - name: nginx-gateway
        kind: NginxGateway
        namespace: idpbuilder-system
    
    gitOpsProviders:
      - name: argocd
        kind: ArgoCDProvider
        namespace: idpbuilder-system

status:
  conditions:
    - type: Ready
      status: "True"
  providers:
    gitProviders:
      - name: gitea-local
        ready: true
    gateways:
      - name: nginx-gateway
        ready: true
    gitOpsProviders:
      - name: argocd
        ready: true</code></pre>

                <h3>Git Provider CRs</h3>
                <p>Git providers expose common status fields via duck-typing:</p>
                
                <h4>GiteaProvider Example</h4>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: GiteaProvider
metadata:
  name: gitea-local
  namespace: idpbuilder-system
spec:
  namespace: gitea
  version: 1.24.3
  
  adminUser:
    username: giteaAdmin
    email: admin@cnoe.localtest.me
    autoGenerate: true
  
  organizations:
    - name: idpbuilder
      description: IDP Builder Bootstrap Organization

status:
  conditions:
    - type: Ready
      status: "True"
  # Duck-typed fields
  endpoint: https://gitea.cnoe.localtest.me
  internalEndpoint: http://gitea-http.gitea.svc.cluster.local:3000
  credentialsSecretRef:
    name: gitea-admin-secret
    namespace: gitea
    key: token</code></pre>

                <h4>GitHubProvider Example</h4>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: GitHubProvider
metadata:
  name: github-external
  namespace: idpbuilder-system
spec:
  organization: my-organization
  endpoint: https://api.github.com
  
  credentialsSecretRef:
    name: github-credentials
    namespace: idpbuilder-system
    key: token
  
  repositoryDefaults:
    visibility: private
    defaultBranch: main

status:
  conditions:
    - type: Ready
      status: "True"
  # Duck-typed fields
  endpoint: https://github.com/my-organization
  internalEndpoint: https://api.github.com
  credentialsSecretRef:
    name: github-credentials
    namespace: idpbuilder-system
    key: token</code></pre>

                <h3>Gateway Provider CRs</h3>
                <p>Gateway providers manage ingress and routing:</p>
                
                <h4>NginxGateway Example</h4>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: NginxGateway
metadata:
  name: nginx-gateway
  namespace: idpbuilder-system
spec:
  namespace: ingress-nginx
  version: 1.13.0
  
  config:
    controller:
      service:
        type: NodePort
        nodePorts:
          http: 30080
          https: 30443
  
  ingressClass:
    name: nginx
    isDefault: true

status:
  conditions:
    - type: Ready
      status: "True"
  # Duck-typed fields
  ingressClassName: nginx
  loadBalancerEndpoint: http://172.18.0.2
  internalEndpoint: http://ingress-nginx-controller.ingress-nginx.svc.cluster.local</code></pre>

                <h3>GitOps Provider CRs</h3>
                <p>GitOps providers manage continuous deployment:</p>
                
                <h4>ArgoCDProvider Example</h4>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: ArgoCDProvider
metadata:
  name: argocd
  namespace: idpbuilder-system
spec:
  namespace: argocd
  version: v2.12.0
  
  adminCredentials:
    autoGenerate: true
  
  projects:
    - name: default
      description: Default project
    - name: platform
      description: Platform components

status:
  conditions:
    - type: Ready
      status: "True"
  # Duck-typed fields
  endpoint: https://argocd.cnoe.localtest.me
  internalEndpoint: http://argocd-server.argocd.svc.cluster.local
  credentialsSecretRef:
    name: argocd-admin-secret
    namespace: argocd
    key: password</code></pre>

                <h2 id="multi-provider">Multi-Provider Support</h2>
                <p>The V2 architecture allows multiple providers of the same type to coexist, enabling flexible configurations:</p>
                
                <h3>Multiple Git Providers Example</h3>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: Platform
metadata:
  name: hybrid
spec:
  domain: cnoe.localtest.me
  components:
    gitProviders:
      # Local development repositories
      - name: gitea-dev
        kind: GiteaProvider
        namespace: idpbuilder-system
      # Production repositories in GitHub
      - name: github-prod
        kind: GitHubProvider
        namespace: idpbuilder-system</code></pre>

                <h3>Multiple Gateway Providers Example</h3>
                <pre class="line-numbers language-yaml"><code class="language-yaml">apiVersion: idpbuilder.cnoe.io/v1alpha1
kind: Platform
metadata:
  name: multi-gateway
spec:
  domain: cnoe.localtest.me
  components:
    gateways:
      # Public-facing services
      - name: nginx-public
        kind: NginxGateway
        namespace: idpbuilder-system
      # Internal service mesh
      - name: envoy-internal
        kind: EnvoyGateway
        namespace: idpbuilder-system</code></pre>

                <h2 id="use-cases">Use Cases</h2>
                
                <h3>Local Development</h3>
                <p>Developers can spin up a complete IDP environment locally with Gitea for Git repositories, Nginx for ingress, and ArgoCD for GitOps.</p>

                <h3>Hybrid Cloud</h3>
                <p>Organizations can use Gitea for development environments while leveraging GitHub or GitLab for production repositories, all managed through a single Platform CR.</p>

                <h3>Service Mesh Integration</h3>
                <p>Teams can deploy Istio Gateway for service mesh capabilities alongside traditional Nginx ingress for different application requirements.</p>

                <h3>Multi-Team GitOps</h3>
                <p>Different teams can use different GitOps tools - ArgoCD for application deployments and Flux for infrastructure management - within the same platform.</p>

                <h2 id="migration">Migration Path</h2>
                <p>The V2 architecture maintains backward compatibility with the existing CLI experience:</p>
                <ul>
                    <li>The CLI automatically generates provider CRs from command-line flags</li>
                    <li>Controllers are installed transparently during cluster creation</li>
                    <li>Users can continue using <code>idpbuilder create</code> without changes</li>
                    <li>Advanced users can directly create and manage CRs for fine-grained control</li>
                </ul>

                <h2 id="next-steps">Next Steps</h2>
                <p>The V2 architecture is currently in the proposal phase. To learn more or provide feedback:</p>
                <ul>
                    <li>Review the <a href="https://github.com/cnoe-io/idpbuilder/blob/main/docs/controller-architecture-spec.md" target="_blank" rel="noopener">full technical specification</a></li>
                    <li>Join discussions on the <a href="https://cloud-native.slack.com/archives/C05TN9WFN5S" target="_blank" rel="noopener">CNCF Slack channel</a></li>
                    <li>Contribute to the <a href="https://github.com/cnoe-io/idpbuilder" target="_blank" rel="noopener">GitHub repository</a></li>
                </ul>
            </article>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 CNOE IDP Builder. Licensed under <a href="https://github.com/cnoe-io/idpbuilder/blob/main/LICENSE" target="_blank" rel="noopener">Apache License 2.0</a></p>
        </div>
    </footer>
    
    <!-- Prism.js scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <!-- Initialize Mermaid -->
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.querySelector('nav');
            const navLinks = document.getElementById('navLinks');
            
            if (!nav.contains(event.target)) {
                navLinks.classList.remove('active');
            }
        });

        // Auto-hide navigation on scroll down, show on scroll up (mobile only)
        let lastScrollTop = 0;
        const header = document.querySelector('header');
        const navLinksElement = document.getElementById('navLinks');
        const scrollDelta = 5; // Minimum scroll distance to trigger hide/show
        
        function handleNavVisibility() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            // Only apply auto-hide on mobile screens
            if (window.innerWidth <= 768) {
                // Make sure we've scrolled more than the delta
                if (Math.abs(lastScrollTop - scrollTop) <= scrollDelta) {
                    return;
                }
                
                // Scrolling down
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    header.classList.add('nav-hidden');
                    // Also close the mobile menu if it's open
                    navLinksElement.classList.remove('active');
                } 
                // Scrolling up
                else if (scrollTop < lastScrollTop) {
                    header.classList.remove('nav-hidden');
                }
                
                lastScrollTop = scrollTop;
            } else {
                // Remove nav-hidden class on desktop
                header.classList.remove('nav-hidden');
            }
        }
        
        window.addEventListener('scroll', handleNavVisibility);
        window.addEventListener('resize', handleNavVisibility);
    </script>
</body>
</html>
